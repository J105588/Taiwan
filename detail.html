<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ãƒãƒƒãƒˆè©³ç´° - å°æ¹¾ä¿®å­¦æ—…è¡Œ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;700&family=Yuji+Syuku&display=swap');

        :root {
            --paper-bg: #fdf5e6;
            --ink: #2b2b2b;
            --border: #8B4513;
            --stamp-color: #cc0000;
        }

        body {
            background: #2b2b2b url('https://www.transparenttextures.com/patterns/wood-pattern.png');
            color: var(--ink);
            font-family: 'Shippori Mincho', serif;
            margin: 0; padding: 0;
        }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–¢é€£ */
        .scroll-wrapper {
            max-width: 900px; margin: 40px auto;
            animation: unfoldScroll 1s cubic-bezier(0.25, 1, 0.5, 1) forwards;
            transform-origin: top center;
        }
        @keyframes unfoldScroll { 0% { transform: scaleY(0.1); opacity: 0; } 100% { transform: scaleY(1); opacity: 1; } }

        .scroll-container {
            background: var(--paper-bg); padding: 60px 80px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.7);
            border-top: 30px solid var(--border); border-bottom: 30px solid var(--border);
            position: relative;
        }

        .back-btn {
            position: fixed; top: 20px; left: 20px; background: var(--border); color: white;
            padding: 10px 20px; text-decoration: none; border-radius: 5px; z-index: 100; font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3); transition: 0.3s;
        }
        .back-btn:hover { background: #a0522d; transform: translateX(-5px); }

        h1 { font-family: 'Yuji Syuku', serif; font-size: 3rem; text-align: center; border-bottom: 2px solid var(--ink); padding-bottom: 20px; margin-bottom: 30px; }
        .hero-img { width: 100%; height: 400px; object-fit: cover; border: 5px double var(--ink); margin-bottom: 30px; }
        
        .info-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; }
        
        .section-box { border: 1px solid var(--ink); padding: 25px; position: relative; margin-bottom: 20px; background: rgba(255,255,255,0.4); }
        .section-box h3 { position: absolute; top: -15px; left: 10px; background: var(--paper-bg); padding: 0 10px; margin: 0; font-family: 'Yuji Syuku'; color: var(--border); font-size: 1.4rem; }
        
        /* èª¬æ˜æ–‡ã®ã‚¹ã‚¿ã‚¤ãƒ«å¼·åŒ–ï¼ˆãƒªã‚¹ãƒˆãªã©ã‚’ç¶ºéº—ã«è¡¨ç¤ºï¼‰ */
        #detail-desc ul { padding-left: 20px; margin: 10px 0; }
        #detail-desc li { margin-bottom: 5px; }
        #detail-desc strong { color: #8B0000; border-bottom: 1px solid #8B0000; }

        .vertical-text { writing-mode: vertical-rl; height: 350px; text-align: justify; line-height: 2; font-size: 1.05rem; }
        .full-width { grid-column: 1 / -1; }

        /* ãŠã‚‚ã—ã‚æ©Ÿèƒ½ï¼šã‚µãƒã‚¤ãƒãƒ«å°æ¹¾èª */
        .survival-widget { position: fixed; bottom: 30px; right: 30px; z-index: 1000; }
        .survival-btn { width: 70px; height: 70px; background: #d32f2f; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.5); border: 3px solid #FFD700; transition: transform 0.3s; }
        .survival-btn:hover { transform: scale(1.1) rotate(10deg); }
        .survival-content { position: absolute; bottom: 90px; right: 0; width: 250px; background: white; border: 2px solid #d32f2f; border-radius: 10px; padding: 15px; display: none; box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
        .phrase-box { border-bottom: 1px dashed #ccc; padding: 5px 0; font-size: 0.9rem; }
        .phrase-tw { font-weight: bold; font-size: 1.1rem; color: #333; }

        /* ãŠã‚‚ã—ã‚æ©Ÿèƒ½ï¼šãƒ‡ã‚¸ã‚¿ãƒ«æ“²æ¯ */
        .oracle-section { margin-top: 50px; text-align: center; border: 4px double #d32f2f; padding: 30px; background: #fff5f5; border-radius: 20px; }
        .moon-blocks { display: flex; justify-content: center; gap: 20px; margin: 20px 0; min-height: 100px; }
        .poe { width: 60px; height: 30px; background: #d32f2f; border-radius: 0 0 60px 60px; position: relative; transition: transform 0.5s; }
        .tossing .poe { animation: toss 1s infinite; }
        @keyframes toss { 0% { transform: translateY(0) rotate(0); } 50% { transform: translateY(-50px) rotate(180deg); } 100% { transform: translateY(0) rotate(360deg); } }
        .oracle-result { font-size: 1.5rem; font-weight: bold; margin-top: 15px; min-height: 1.5em; color: #b71c1c; }
        .oracle-btn { background: #d32f2f; color: white; border: none; padding: 10px 30px; font-size: 1.2rem; border-radius: 30px; cursor: pointer; box-shadow: 0 4px 0 #8b0000; }
        .oracle-btn:active { transform: translateY(4px); box-shadow: none; }

    </style>
</head>
<body>

    <a href="index.html" class="back-btn">â† ä¸€è¦§ã«æˆ»ã‚‹</a>

    <div class="scroll-wrapper">
        <div class="scroll-container">
            
            <h1 id="detail-name">Loading...</h1>
            <img id="detail-img" src="" class="hero-img">

            <div class="info-grid">
                <div class="section-box full-width">
                    <h3>è©³ç´°ãƒ‡ãƒ¼ã‚¿ãƒ»è§£èª¬</h3>
                    <!-- innerHTMLã«å¤‰æ›´ã—ã¦HTMLã‚¿ã‚°(ãƒªã‚¹ãƒˆç­‰)ã‚’æœ‰åŠ¹åŒ– -->
                    <div id="detail-desc" style="line-height: 1.8;"></div>
                </div>
                <div class="section-box">
                    <h3>æ­´å²ãƒ»èƒŒæ™¯</h3>
                    <!-- ã“ã“ã‚‚innerHTMLã«å¤‰æ›´ -->
                    <div id="detail-history" class="vertical-text"></div>
                </div>
                <div class="section-box">
                    <h3>æ”»ç•¥æƒ…å ±</h3>
                    <ul style="padding-left: 20px; line-height: 2;">
                        <li><strong>ã‚«ãƒ†ã‚´ãƒª:</strong> <span id="detail-category"></span></li>
                        <li><strong>å¿…é£Ÿãƒ»æ³¨ç›®:</strong> <span id="detail-food" style="background: linear-gradient(transparent 60%, #ffeb3b 60%); font-weight:bold;"></span></li>
                        <li><strong>ä¸€è¨€:</strong> <span id="detail-catch"></span></li>
                    </ul>
                </div>
            </div>

            <!-- æ“²æ¯ï¼ˆãƒã‚¨ï¼‰ -->
            <div class="oracle-section">
                <div style="font-family: 'Yuji Syuku'; font-size: 2rem; color: #d32f2f; margin-bottom: 10px;">è¿·ã£ãŸã‚‰ç¥é ¼ã¿ï¼ãƒ‡ã‚¸ã‚¿ãƒ«æ“²æ¯</div>
                <p>ã€Œã“ã®ãŠåœŸç”£è²·ã†ã¹ãï¼Ÿã€ã¨å¿µã˜ã¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã›ï¼</p>
                <div class="moon-blocks" id="moon-blocks">
                    <div class="poe" id="poe1"></div>
                    <div class="poe" id="poe2"></div>
                </div>
                <div id="oracle-msg" class="oracle-result">çµæœã‚’å¾…ã£ã¦ã„ã¾ã™...</div>
                <button class="oracle-btn" onclick="askGods()">ç¥ã«å•ã†</button>
            </div>

        </div>
    </div>

    <!-- ã‚µãƒã‚¤ãƒãƒ«å°æ¹¾èª -->
    <div class="survival-widget">
        <div class="survival-content" id="survival-box">
            <h4 style="margin:0 0 10px; color:#d32f2f; text-align:center;">ğŸš‘ ã‚µãƒã‚¤ãƒãƒ«å°æ¹¾èª</h4>
            <div class="phrase-box"><div>ãƒˆã‚¤ãƒ¬ã¯ã©ã“ï¼Ÿ</div><div class="phrase-tw">ãƒ„ã‚©ãƒ¼ã‚¹ã‚ª ã‚¶ã‚¤ ãƒŠãƒ¼ãƒªï¼Ÿ</div></div>
            <div class="phrase-box"><div>å®‰ãã—ã¦ãã ã•ã„</div><div class="phrase-tw">ã‚¹ã‚¢ãƒ³ ãƒ”ã‚¨ãƒ³ã‚¤ãƒ¼ ã‚¤ãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³</div></div>
            <div class="phrase-box"><div>ãƒ‘ã‚¯ãƒãƒ¼å…¥ã‚Œãªã„ã§</div><div class="phrase-tw">ãƒ—ãƒ¼ãƒ¤ã‚ª ã‚·ãƒ£ãƒ³ãƒ„ã‚¡ã‚¤ï¼</div></div>
            <div class="phrase-box"><div>æœ€é«˜ï¼</div><div class="phrase-tw">ã‚¿ã‚¤ ãƒãƒ³ ãƒ©ï¼</div></div>
        </div>
        <div class="survival-btn" onclick="toggleSurvival()">è©±</div>
    </div>

    <script>
        function toggleSurvival() {
            const box = document.getElementById('survival-box');
            box.style.display = box.style.display === 'block' ? 'none' : 'block';
        }

        function askGods() {
            const poe1 = document.getElementById('poe1');
            const poe2 = document.getElementById('poe2');
            const msg = document.getElementById('oracle-msg');
            const blocks = document.getElementById('moon-blocks');
            blocks.classList.add('tossing');
            msg.innerText = "ç¥æ§˜ãŒè€ƒãˆä¸­...";
            setTimeout(() => {
                blocks.classList.remove('tossing');
                const res1 = Math.random() < 0.5 ? 0 : 1;
                const res2 = Math.random() < 0.5 ? 0 : 1;
                poe1.style.transform = `rotate(${Math.random() * 360}deg) scaleY(${res1 === 0 ? -1 : 1})`;
                poe2.style.transform = `rotate(${Math.random() * 360}deg) scaleY(${res2 === 0 ? -1 : 1})`;
                if (res1 !== res2) { msg.innerText = "ã€è–æ¯ã€‘YESï¼ç¥ã®æ‰¿èªï¼"; msg.style.color = "red"; }
                else if (res1 === 0 && res2 === 0) { msg.innerText = "ã€ç¬‘æ¯ã€‘ç¬‘ã£ã¦ã‚‹ã ã‘ï¼ˆã‚‚ã†ä¸€åº¦ï¼‰"; msg.style.color = "orange"; }
                else { msg.innerText = "ã€é™°æ¯ã€‘NOï¼ã‚„ã‚ã¨ã‘ï¼"; msg.style.color = "blue"; }
            }, 1000);
        }

        async function loadDetail() {
            const urlParams = new URLSearchParams(window.location.search);
            const spotId = urlParams.get('id');
            if (!spotId) return;

            try {
                const response = await fetch('spots.csv');
                const text = await response.text();
                const rows = text.split('\n').slice(1);
                
                // CSVãƒ‘ãƒ¼ã‚¹ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã ãŒãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆå†…ã®ã‚«ãƒ³ãƒã¯ç„¡è¦–ã™ã‚‹æ­£è¦è¡¨ç¾ï¼‰
                const row = rows.find(r => r.startsWith(spotId + ','));
                
                if (row) {
                    // ã‚ˆã‚Šå …ç‰¢ãªCSVåˆ†å‰²ãƒ­ã‚¸ãƒƒã‚¯
                    const cols = [];
                    let current = '';
                    let inQuote = false;
                    for (let i = 0; i < row.length; i++) {
                        const char = row[i];
                        if (char === '"') { inQuote = !inQuote; }
                        else if (char === ',' && !inQuote) { cols.push(current); current = ''; }
                        else { current += char; }
                    }
                    cols.push(current); // æœ€å¾Œã®ã‚«ãƒ©ãƒ 

                    const cleanCols = cols.map(c => c.trim().replace(/^"|"$/g, '').replace(/""/g, '"'));
                    
                    document.getElementById('detail-name').innerText = cleanCols[1];
                    document.getElementById('detail-category').innerText = cleanCols[2];
                    document.getElementById('detail-catch').innerText = cleanCols[3];
                    
                    // HTMLã‚¿ã‚°ã‚’æœ‰åŠ¹ã«ã™ã‚‹ãŸã‚ innerHTML ã‚’ä½¿ç”¨
                    document.getElementById('detail-desc').innerHTML = cleanCols[4];
                    document.getElementById('detail-history').innerHTML = cleanCols[5];
                    
                    document.getElementById('detail-food').innerText = cleanCols[6];
                    document.getElementById('detail-img').src = cleanCols[7];
                }
            } catch (e) { console.error(e); }
        }

        window.onload = loadDetail;
    </script>
</body>
</html>
