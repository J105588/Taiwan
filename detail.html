<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>スポット詳細 - 台湾修学旅行</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;700&family=Yuji+Syuku&display=swap');

        :root {
            --paper-bg: #fdf5e6;
            --ink: #2b2b2b;
            --border: #8B4513;
            --stamp-color: #cc0000;
        }

        body {
            background: #2b2b2b url('https://www.transparenttextures.com/patterns/wood-pattern.png');
            color: var(--ink);
            font-family: 'Shippori Mincho', serif;
            margin: 0; padding: 0;
        }

        /* アニメーション関連 */
        .scroll-wrapper {
            max-width: 900px; margin: 40px auto;
            animation: unfoldScroll 1s cubic-bezier(0.25, 1, 0.5, 1) forwards;
            transform-origin: top center;
        }
        @keyframes unfoldScroll { 0% { transform: scaleY(0.1); opacity: 0; } 100% { transform: scaleY(1); opacity: 1; } }

        .scroll-container {
            background: var(--paper-bg); padding: 60px 80px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.7);
            border-top: 30px solid var(--border); border-bottom: 30px solid var(--border);
            position: relative;
        }

        .back-btn {
            position: fixed; top: 20px; left: 20px; background: var(--border); color: white;
            padding: 10px 20px; text-decoration: none; border-radius: 5px; z-index: 100; font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3); transition: 0.3s;
        }
        .back-btn:hover { background: #a0522d; transform: translateX(-5px); }

        h1 { font-family: 'Yuji Syuku', serif; font-size: 3rem; text-align: center; border-bottom: 2px solid var(--ink); padding-bottom: 20px; margin-bottom: 30px; }
        .hero-img { width: 100%; height: 400px; object-fit: cover; border: 5px double var(--ink); margin-bottom: 30px; }
        
        .info-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; }
        
        .section-box { border: 1px solid var(--ink); padding: 25px; position: relative; margin-bottom: 20px; background: rgba(255,255,255,0.4); }
        .section-box h3 { position: absolute; top: -15px; left: 10px; background: var(--paper-bg); padding: 0 10px; margin: 0; font-family: 'Yuji Syuku'; color: var(--border); font-size: 1.4rem; }
        
        /* 説明文のスタイル強化（リストなどを綺麗に表示） */
        #detail-desc ul { padding-left: 20px; margin: 10px 0; }
        #detail-desc li { margin-bottom: 5px; }
        #detail-desc strong { color: #8B0000; border-bottom: 1px solid #8B0000; }

        .vertical-text { writing-mode: vertical-rl; height: 350px; text-align: justify; line-height: 2; font-size: 1.05rem; }
        .full-width { grid-column: 1 / -1; }

        /* おもしろ機能：サバイバル台湾語 */
        .survival-widget { position: fixed; bottom: 30px; right: 30px; z-index: 1000; }
        .survival-btn { width: 70px; height: 70px; background: #d32f2f; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.5); border: 3px solid #FFD700; transition: transform 0.3s; }
        .survival-btn:hover { transform: scale(1.1) rotate(10deg); }
        .survival-content { position: absolute; bottom: 90px; right: 0; width: 250px; background: white; border: 2px solid #d32f2f; border-radius: 10px; padding: 15px; display: none; box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
        .phrase-box { border-bottom: 1px dashed #ccc; padding: 5px 0; font-size: 0.9rem; }
        .phrase-tw { font-weight: bold; font-size: 1.1rem; color: #333; }

        /* おもしろ機能：デジタル擲杯 */
        .oracle-section { margin-top: 50px; text-align: center; border: 4px double #d32f2f; padding: 30px; background: #fff5f5; border-radius: 20px; }
        .moon-blocks { display: flex; justify-content: center; gap: 20px; margin: 20px 0; min-height: 100px; }
        .poe { width: 60px; height: 30px; background: #d32f2f; border-radius: 0 0 60px 60px; position: relative; transition: transform 0.5s; }
        .tossing .poe { animation: toss 1s infinite; }
        @keyframes toss { 0% { transform: translateY(0) rotate(0); } 50% { transform: translateY(-50px) rotate(180deg); } 100% { transform: translateY(0) rotate(360deg); } }
        .oracle-result { font-size: 1.5rem; font-weight: bold; margin-top: 15px; min-height: 1.5em; color: #b71c1c; }
        .oracle-btn { background: #d32f2f; color: white; border: none; padding: 10px 30px; font-size: 1.2rem; border-radius: 30px; cursor: pointer; box-shadow: 0 4px 0 #8b0000; }
        .oracle-btn:active { transform: translateY(4px); box-shadow: none; }

    </style>
</head>
<body>

    <a href="index.html" class="back-btn">← 一覧に戻る</a>

    <div class="scroll-wrapper">
        <div class="scroll-container">
            
            <h1 id="detail-name">Loading...</h1>
            <img id="detail-img" src="" class="hero-img">

            <div class="info-grid">
                <div class="section-box full-width">
                    <h3>詳細データ・解説</h3>
                    <!-- innerHTMLに変更してHTMLタグ(リスト等)を有効化 -->
                    <div id="detail-desc" style="line-height: 1.8;"></div>
                </div>
                <div class="section-box">
                    <h3>歴史・背景</h3>
                    <!-- ここもinnerHTMLに変更 -->
                    <div id="detail-history" class="vertical-text"></div>
                </div>
                <div class="section-box">
                    <h3>攻略情報</h3>
                    <ul style="padding-left: 20px; line-height: 2;">
                        <li><strong>カテゴリ:</strong> <span id="detail-category"></span></li>
                        <li><strong>必食・注目:</strong> <span id="detail-food" style="background: linear-gradient(transparent 60%, #ffeb3b 60%); font-weight:bold;"></span></li>
                        <li><strong>一言:</strong> <span id="detail-catch"></span></li>
                    </ul>
                </div>
            </div>

            <!-- 擲杯（ポエ） -->
            <div class="oracle-section">
                <div style="font-family: 'Yuji Syuku'; font-size: 2rem; color: #d32f2f; margin-bottom: 10px;">迷ったら神頼み！デジタル擲杯</div>
                <p>「このお土産買うべき？」と念じてボタンを押せ！</p>
                <div class="moon-blocks" id="moon-blocks">
                    <div class="poe" id="poe1"></div>
                    <div class="poe" id="poe2"></div>
                </div>
                <div id="oracle-msg" class="oracle-result">結果を待っています...</div>
                <button class="oracle-btn" onclick="askGods()">神に問う</button>
            </div>

        </div>
    </div>

    <!-- サバイバル台湾語 -->
    <div class="survival-widget">
        <div class="survival-content" id="survival-box">
            <h4 style="margin:0 0 10px; color:#d32f2f; text-align:center;">サバイバル中国語</h4>
            <div class="phrase-box"><div>トイレはどこ？</div><div class="phrase-tw">ツォースオ ザイ ナーリ？</div></div>
            <div class="phrase-box"><div>安くしてください</div><div class="phrase-tw">スアン ピエンイー イーディエン</div></div>
            <div class="phrase-box"><div>パクチー入れないで</div><div class="phrase-tw">プーヤオ シャンツァイ！</div></div>
            <div class="phrase-box"><div>最高！</div><div class="phrase-tw">タイ バン ラ！</div></div>
        </div>
        <div class="survival-btn" onclick="toggleSurvival()">話</div>
    </div>

    <script>
        function toggleSurvival() {
            const box = document.getElementById('survival-box');
            box.style.display = box.style.display === 'block' ? 'none' : 'block';
        }

        function askGods() {
            const poe1 = document.getElementById('poe1');
            const poe2 = document.getElementById('poe2');
            const msg = document.getElementById('oracle-msg');
            const blocks = document.getElementById('moon-blocks');
            blocks.classList.add('tossing');
            msg.innerText = "神様が考え中...";
            setTimeout(() => {
                blocks.classList.remove('tossing');
                const res1 = Math.random() < 0.5 ? 0 : 1;
                const res2 = Math.random() < 0.5 ? 0 : 1;
                poe1.style.transform = `rotate(${Math.random() * 360}deg) scaleY(${res1 === 0 ? -1 : 1})`;
                poe2.style.transform = `rotate(${Math.random() * 360}deg) scaleY(${res2 === 0 ? -1 : 1})`;
                if (res1 !== res2) { msg.innerText = "【聖杯】YES！神の承認！"; msg.style.color = "red"; }
                else if (res1 === 0 && res2 === 0) { msg.innerText = "【笑杯】笑ってるだけ（もう一度）"; msg.style.color = "orange"; }
                else { msg.innerText = "【陰杯】NO！やめとけ！"; msg.style.color = "blue"; }
            }, 1000);
        }

        async function loadDetail() {
            const urlParams = new URLSearchParams(window.location.search);
            const spotId = urlParams.get('id');
            if (!spotId) return;

            try {
                const response = await fetch('spots.csv');
                const text = await response.text();
                const rows = text.split('\n').slice(1);
                
                // CSVパース（カンマ区切りだがダブルクォート内のカンマは無視する正規表現）
                const row = rows.find(r => r.startsWith(spotId + ','));
                
                if (row) {
                    // より堅牢なCSV分割ロジック
                    const cols = [];
                    let current = '';
                    let inQuote = false;
                    for (let i = 0; i < row.length; i++) {
                        const char = row[i];
                        if (char === '"') { inQuote = !inQuote; }
                        else if (char === ',' && !inQuote) { cols.push(current); current = ''; }
                        else { current += char; }
                    }
                    cols.push(current); // 最後のカラム

                    const cleanCols = cols.map(c => c.trim().replace(/^"|"$/g, '').replace(/""/g, '"'));
                    
                    document.getElementById('detail-name').innerText = cleanCols[1];
                    document.getElementById('detail-category').innerText = cleanCols[2];
                    document.getElementById('detail-catch').innerText = cleanCols[3];
                    
                    // HTMLタグを有効にするため innerHTML を使用
                    document.getElementById('detail-desc').innerHTML = cleanCols[4];
                    document.getElementById('detail-history').innerHTML = cleanCols[5];
                    
                    document.getElementById('detail-food').innerText = cleanCols[6];
                    document.getElementById('detail-img').src = cleanCols[7];
                }
            } catch (e) { console.error(e); }
        }

        window.onload = loadDetail;
    </script>
</body>
</html>

