<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>スポット詳細 - 台湾修学旅行</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;700&family=Yuji+Syuku&display=swap');

        :root {
            --paper-bg: #fdf5e6;
            --ink: #2b2b2b;
            --border: #8B4513;
            --stamp-color: #cc0000;
            --red-accent: #d32f2f;
        }

        body {
            background: #2b2b2b url('https://www.transparenttextures.com/patterns/wood-pattern.png');
            color: var(--ink);
            font-family: 'Shippori Mincho', serif;
            margin: 0; padding: 0;
            overflow-x: hidden;
        }

        /* --- アニメーション：巻物が広がる演出 --- */
        .scroll-wrapper {
            max-width: 900px; margin: 40px auto;
            padding: 0 20px; /* スマホ用余白 */
            animation: unfoldScroll 1s cubic-bezier(0.25, 1, 0.5, 1) forwards;
            transform-origin: top center;
        }
        @keyframes unfoldScroll { 
            0% { transform: scaleY(0.1); opacity: 0; } 
            100% { transform: scaleY(1); opacity: 1; } 
        }

        .scroll-container {
            background: var(--paper-bg); padding: 60px 80px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.7);
            border-top: 20px solid var(--border); border-bottom: 20px solid var(--border);
            position: relative;
        }

        /* --- 戻るボタン --- */
        .back-btn {
            position: fixed; top: 20px; left: 20px;
            background: var(--border); color: white;
            padding: 10px 20px; text-decoration: none; border-radius: 5px;
            z-index: 100; font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3); transition: 0.3s;
        }
        .back-btn:hover { background: #a0522d; transform: scale(1.05); }

        /* --- 基本デザイン --- */
        h1 {
            font-family: 'Yuji Syuku', serif; font-size: 3rem; text-align: center;
            border-bottom: 2px solid var(--ink); padding-bottom: 20px; margin-bottom: 30px;
        }
        .hero-img { width: 100%; height: 400px; object-fit: cover; border: 5px double var(--ink); margin-bottom: 30px; }
        
        .stamp {
            position: absolute; top: 30px; right: 30px;
            width: 90px; height: 90px; border: 3px solid var(--stamp-color); border-radius: 50%;
            color: var(--stamp-color); display: flex; align-items: center; justify-content: center;
            font-family: 'Yuji Syuku'; font-size: 1.4rem; transform: rotate(-15deg);
            opacity: 0.8; mask-image: url('https://www.transparenttextures.com/patterns/grunge-wall.png');
            pointer-events: none;
        }

        /* --- グリッドレイアウト --- */
        .info-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 30px; margin-bottom: 40px; }
        
        .section-box {
            border: 1px solid var(--ink); padding: 25px; position: relative;
            background: rgba(255,255,255,0.4);
        }
        .section-box h3 {
            position: absolute; top: -15px; left: 10px; background: var(--paper-bg);
            padding: 0 10px; margin: 0; font-family: 'Yuji Syuku'; color: var(--border); font-size: 1.3rem;
        }
        
        .full-width { grid-column: 1 / -1; }
        .highlight { background: linear-gradient(transparent 60%, #ffeb3b 60%); font-weight: bold; }

        /* 歴史用：縦書き設定 */
        .vertical-text {
            writing-mode: vertical-rl; height: 350px; text-align: justify;
            line-height: 2; font-size: 1.05rem;
        }

        /* --- おもしろ機能：デジタル擲杯 (Oracle) --- */
        .oracle-section {
            margin-top: 50px; text-align: center; border: 4px double var(--red-accent);
            padding: 30px; background: #fff5f5; border-radius: 20px;
        }
        .moon-blocks { display: flex; justify-content: center; gap: 20px; margin: 20px 0; min-height: 80px; }
        .poe {
            width: 60px; height: 30px; background: var(--red-accent); border-radius: 0 0 60px 60px;
            position: relative; transition: transform 0.5s;
        }
        .tossing .poe { animation: toss 1s infinite; }
        @keyframes toss { 
            0% { transform: translateY(0) rotate(0); } 
            50% { transform: translateY(-50px) rotate(180deg); } 
            100% { transform: translateY(0) rotate(360deg); } 
        }
        .oracle-result { font-size: 1.5rem; font-weight: bold; margin-top: 15px; min-height: 1.5em; color: #b71c1c; }
        .oracle-btn {
            background: var(--red-accent); color: white; border: none; padding: 10px 30px;
            font-size: 1.2rem; border-radius: 30px; cursor: pointer; box-shadow: 0 4px 0 #8b0000;
            font-family: 'Yuji Syuku';
        }
        .oracle-btn:active { transform: translateY(4px); box-shadow: none; }

        /* --- おもしろ機能：サバイバル台湾語ウィジェット --- */
        .survival-widget { position: fixed; bottom: 30px; right: 30px; z-index: 1000; }
        .survival-btn {
            width: 60px; height: 60px; background: var(--red-accent); color: white;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            border: 3px solid #FFD700; transition: transform 0.3s;
        }
        .survival-btn:hover { transform: scale(1.1) rotate(10deg); }
        .survival-content {
            position: absolute; bottom: 80px; right: 0; width: 260px;
            background: white; border: 2px solid var(--red-accent); border-radius: 10px;
            padding: 15px; display: none; box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        .phrase-box { border-bottom: 1px dashed #ccc; padding: 8px 0; font-size: 0.9rem; }
        .phrase-tw { font-weight: bold; font-size: 1.1rem; color: #333; display: block; margin-top: 2px; }

        /* --- スマホ対応 (レスポンシブ) --- */
        @media (max-width: 768px) {
            .scroll-wrapper { margin: 60px auto 20px; padding: 0; }
            .scroll-container {
                padding: 40px 20px;
                width: 100%; box-sizing: border-box;
                border-width: 10px 0;
            }
            h1 { font-size: 2rem; margin-bottom: 20px; }
            .hero-img { height: 250px; margin-bottom: 20px; }
            
            /* グリッド解除 */
            .info-grid { display: flex; flex-direction: column; gap: 30px; }
            
            /* 縦書き解除（スマホで読みやすく） */
            .vertical-text { writing-mode: horizontal-tb; height: auto; text-align: left; }
            
            .stamp { width: 70px; height: 70px; font-size: 1rem; top: 10px; right: 10px; }
            
            /* ウィジェット調整 */
            .survival-widget { bottom: 20px; right: 20px; }
        }
    </style>
</head>
<body>

    <a href="index.html" class="back-btn">← 一覧に戻る</a>

    <div class="scroll-wrapper">
        <div class="scroll-container">
            <div class="stamp">必見<br>スポット</div>
            
            <h1 id="detail-name">読み込み中...</h1>
            <img id="detail-img" src="" class="hero-img" alt="">

            <div class="info-grid">
                <!-- 概要 -->
                <div class="section-box full-width">
                    <h3>解説データ</h3>
                    <!-- innerHTMLでタグを有効化 -->
                    <div id="detail-desc" style="font-size: 1rem; line-height: 1.8;"></div>
                </div>

                <!-- 歴史 (PCは縦書き、スマホは横書き) -->
                <div class="section-box">
                    <h3>歴史・背景</h3>
                    <div id="detail-history" class="vertical-text"></div>
                </div>

                <!-- 攻略情報 -->
                <div class="section-box">
                    <h3>攻略メモ</h3>
                    <ul style="list-style: square; padding-left: 20px; line-height: 2;">
                        <li><strong>カテゴリ:</strong> <span id="detail-category"></span></li>
                        <li><strong>必食:</strong> <span id="detail-food" class="highlight"></span></li>
                        <li><strong>一言:</strong> <span id="detail-catch"></span></li>
                    </ul>
                </div>
            </div>

            <!-- おもしろ機能：デジタル擲杯 -->
            <div class="oracle-section">
                <div style="font-family: 'Yuji Syuku'; font-size: 1.5rem; color: var(--red-accent); margin-bottom: 10px;">
                    迷ったら神頼み！デジタル擲杯(ポエ)
                </div>
                <p>「このお土産買うべき？」と念じてボタンを押せ！</p>
                <div class="moon-blocks" id="moon-blocks">
                    <div class="poe" id="poe1"></div>
                    <div class="poe" id="poe2"></div>
                </div>
                <div id="oracle-msg" class="oracle-result"></div>
                <button class="oracle-btn" onclick="askGods()">神に問う</button>
            </div>

        </div>
    </div>

    <!-- おもしろ機能：サバイバル台湾語 -->
    <div class="survival-widget">
        <div class="survival-content" id="survival-box">
            <h4 style="margin:0 0 10px; color:var(--red-accent); text-align:center;">サバイバル中国語</h4>
            <div class="phrase-box"><div>トイレはどこ？</div><span class="phrase-tw">ツォースオ ザイ ナーリ？</span></div>
            <div class="phrase-box"><div>安くしてください</div><span class="phrase-tw">スアン ピエンイー イーディエン</span></div>
            <div class="phrase-box"><div>パクチー入れないで</div><span class="phrase-tw">プーヤオ シャンツァイ！</span></div>
            <div class="phrase-box"><div>最高！(美味しい)</div><span class="phrase-tw">ハオチー！ / タイ バン ラ！</span></div>
        </div>
        <div class="survival-btn" onclick="toggleSurvival()">話</div>
    </div>

    <script>
        // サバイバル中国語の開閉
        function toggleSurvival() {
            const box = document.getElementById('survival-box');
            box.style.display = box.style.display === 'block' ? 'none' : 'block';
        }

        // デジタル擲杯（ポエ）ロジック
        function askGods() {
            const poe1 = document.getElementById('poe1');
            const poe2 = document.getElementById('poe2');
            const msg = document.getElementById('oracle-msg');
            const blocks = document.getElementById('moon-blocks');
            
            blocks.classList.add('tossing');
            msg.innerText = "神様が考え中...";
            
            setTimeout(() => {
                blocks.classList.remove('tossing');
                // 0=裏(平ら), 1=表(膨らみ)
                const res1 = Math.random() < 0.5 ? 0 : 1;
                const res2 = Math.random() < 0.5 ? 0 : 1;
                
                // アニメーション後の角度と向き設定
                poe1.style.transform = `rotate(${Math.random() * 360}deg) scaleY(${res1 === 0 ? -1 : 1})`;
                poe2.style.transform = `rotate(${Math.random() * 360}deg) scaleY(${res2 === 0 ? -1 : 1})`;
                
                if (res1 !== res2) {
                    msg.innerText = "【聖杯】YES！神の承認！(Go ahead)";
                    msg.style.color = "red";
                } else if (res1 === 0 && res2 === 0) {
                    msg.innerText = "【笑杯】笑ってるだけ (もう一度)";
                    msg.style.color = "orange";
                } else {
                    msg.innerText = "【陰杯】NO！やめとけ！(Stop)";
                    msg.style.color = "blue";
                }
            }, 1000);
        }

        // データ読み込み（堅牢版）
        async function loadDetail() {
            const urlParams = new URLSearchParams(window.location.search);
            const spotId = urlParams.get('id');

            if (!spotId) {
                alert('データが見つかりません');
                window.location.href = 'index.html';
                return;
            }

            try {
                const response = await fetch('spots.csv');
                const data = await response.text();
                const rows = data.split('\n').slice(1);
                
                // ID一致行を検索
                const row = rows.find(r => r.startsWith(spotId + ','));
                
                if (row) {
                    // カンマを含むCSVを正しくパースするループ処理
                    const cols = [];
                    let current = '';
                    let inQuote = false;
                    for (let i = 0; i < row.length; i++) {
                        const char = row[i];
                        if (char === '"') { inQuote = !inQuote; }
                        else if (char === ',' && !inQuote) { cols.push(current); current = ''; }
                        else { current += char; }
                    }
                    cols.push(current);
                    // クォート除去
                    const clean = cols.map(c => c.trim().replace(/^"|"$/g, '').replace(/""/g, '"'));
                    
                    document.getElementById('detail-name').innerText = clean[1];
                    document.getElementById('detail-category').innerText = clean[2];
                    document.getElementById('detail-catch').innerText = clean[3];
                    
                    // innerHTMLを使ってHTMLタグ(リストや改行)を反映
                    document.getElementById('detail-desc').innerHTML = clean[4];
                    document.getElementById('detail-history').innerHTML = clean[5];
                    
                    document.getElementById('detail-food').innerText = clean[6];
                    document.getElementById('detail-img').src = clean[7];
                } else {
                    document.querySelector('.scroll-container').innerHTML = '<h2>データが見つかりません</h2>';
                }

            } catch (error) {
                console.error(error);
                document.querySelector('.scroll-container').innerHTML = '<h2>読み込みエラー</h2>';
            }
        }

        window.onload = loadDetail;
    </script>
</body>
</html>
